<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FPT Polytechnic - Hệ thống quản lý điểm</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&family=Space+Grotesk:wght@500;600;700&display=swap"
        rel="stylesheet">

    <!-- External libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/auth.css">
    <link rel="stylesheet" href="/css/timer.css">
    <link rel="stylesheet" href="/css/reliability.css">
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img id="appSidebarLogo" src="https://caodang.fpt.edu.vn/wp-content/uploads/logo-3.png" alt="FPT Polytechnic" class="logo">
        </div>

        <nav class="sidebar-nav">
            <a href="/grade-check" class="nav-item active" data-route="/grade-check">
                <i class="bi bi-clipboard-data-fill"></i>
                <span>Kiểm tra điểm</span>
            </a>
            <a href="/profiles" class="nav-item" data-route="/profiles">
                <i class="bi bi-gear-fill"></i>
                <span>Quản lý Profile</span>
            </a>
            <a href="/classes" class="nav-item" data-route="/classes">
                <i class="bi bi-people-fill"></i>
                <span>Quản lý Lớp học</span>
            </a>
            <a href="/template" class="nav-item" data-route="/template">
                <i class="bi bi-file-earmark-text-fill"></i>
                <span>Tạo Template</span>
            </a>
            <a href="/timer" class="nav-item" data-route="/timer">
                <i class="bi bi-stopwatch-fill"></i>
                <span>Hẹn giờ</span>
            </a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Header -->
        <header class="top-header">
            <div class="header-left">
                <button class="btn-toggle-sidebar" id="toggleSidebar">
                    <i class="bi bi-list"></i>
                </button>

                <div class="header-logo d-md-none">
                    <img id="appHeaderLogo" src="https://caodang.fpt.edu.vn/wp-content/uploads/logo-3.png" alt="FPT" height="30">
                </div>
            </div>

            <div class="header-center d-none d-md-block">
                <h1 class="header-title mb-0">
                    <i class="bi bi-mortarboard-fill text-primary"></i>
                    Hệ thống quản lý điểm sinh viên
                </h1>
                <p class="header-subtitle mb-0" id="appHeaderSubtext">FPT Polytechnic</p>
            </div>

            <div class="header-right">
                <button class="btn btn-link text-dark position-relative p-2" title="Thông báo">
                    <i class="bi bi-bell-fill fs-5"></i>
                    <span
                        class="badge bg-danger rounded-pill position-absolute top-0 start-100 translate-middle">2</span>
                </button>

                <button class="btn btn-link text-dark p-2 d-none d-md-inline-block" title="Trợ giúp">
                    <i class="bi bi-question-circle-fill fs-5"></i>
                </button>

                <div class="dropdown">
                    <button class="btn user-profile-btn text-dark dropdown-toggle d-flex align-items-center gap-2"
                        type="button" data-bs-toggle="dropdown">
                        <img src="" alt="User Avatar" class="user-picture"
                            style="display: none; width: 32px; height: 32px; border-radius: 50%; object-fit: cover;">
                        <i class="bi bi-person-circle fs-4 user-icon-default text-primary"></i>
                        <span class="user-name" style="font-weight: 500;">Người dùng</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end shadow">
                        <li>
                            <div class="dropdown-header">
                                <div class="fw-bold user-name">Người dùng</div>
                                <small class="text-muted user-email">user@example.com</small>
                            </div>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li>
                            <a class="dropdown-item" href="#">
                                <i class="bi bi-person me-2"></i>Thông tin cá nhân
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="#">
                                <i class="bi bi-gear me-2"></i>Cài đặt
                            </a>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li>
                            <a class="dropdown-item text-danger btn-logout" href="#" style="cursor: pointer;">
                                <i class="bi bi-box-arrow-right me-2"></i>Đăng xuất
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </header>

        <!-- Mobile Bottom Navigation -->
        <nav class="mobile-bottom-nav d-md-none">
            <a href="/grade-check" class="mobile-nav-item active" data-route="/grade-check">
                <i class="bi bi-clipboard-data-fill"></i>
                <span>Kiểm tra</span>
            </a>
            <a href="/profiles" class="mobile-nav-item" data-route="/profiles">
                <i class="bi bi-gear-fill"></i>
                <span>Profile</span>
            </a>
            <a href="/classes" class="mobile-nav-item" data-route="/classes">
                <i class="bi bi-people-fill"></i>
                <span>Lớp học</span>
            </a>
            <a href="/template" class="mobile-nav-item" data-route="/template">
                <i class="bi bi-file-earmark-text-fill"></i>
                <span>Template</span>
            </a>
            <a href="/timer" class="mobile-nav-item" data-route="/timer">
                <i class="bi bi-stopwatch-fill"></i>
                <span>Hẹn giờ</span>
            </a>
        </nav>

        <!-- Page Content -->
        <div class="page-content">
            <!-- TAB 1: Kiểm tra điểm -->
            <div id="tab-grade-check" class="tab-content active">
                <h2 class="page-title mb-4">
                    <i class="bi bi-clipboard-data text-primary"></i> Kiểm tra điểm qua môn
                </h2>

                <!-- Profile Selector -->
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-4">
                                <label class="form-label fw-bold">
                                    <i class="bi bi-gear"></i> Chọn Profile điểm
                                </label>
                                <select id="gradeProfileSelect" class="form-select"
                                    onchange="GradeCheckModule.loadGradeProfile()">
                                    <option value="">-- Chọn profile --</option>
                                </select>
                            </div>
                            <div class="col-md-8">
                                <div id="gradeProfileSummary" class="alert alert-warning mb-0 mt-3 mt-md-0">
                                    Chưa chọn profile
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Upload Section -->
                <div class="card mb-4">
                    <div class="card-body text-center upload-section">
                        <div class="file-input-wrapper">
                            <input type="file" id="fileInput" accept=".xlsx, .xls" onchange="handleFile(event)">
                            <label for="fileInput" class="btn btn-primary btn-lg">
                                <i class="bi bi-cloud-upload"></i> Chọn file Excel điểm
                            </label>
                        </div>
                        <div class="file-name mt-3" id="fileName"></div>
                    </div>
                </div>

                <!-- Weight Info -->
                <div class="card mb-4">
                    <div class="card-header bg-info bg-opacity-10">
                        <h5 class="mb-0 text-info">
                            <i class="bi bi-info-circle"></i> Thông tin trọng số điểm
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="weights-grid" id="gradeWeightsGrid">
                            <p class="text-muted">Vui lòng chọn profile để xem trọng số</p>
                        </div>
                    </div>
                </div>

                <!-- Results Section -->
                <div id="resultsSection" class="results-section hidden">
                    <div class="row g-3 mb-4">
                        <div class="col-md-3">
                            <div class="stat-card">
                                <div class="stat-icon bg-primary bg-opacity-10 text-primary">
                                    <i class="bi bi-people-fill"></i>
                                </div>
                                <h3 id="totalStudents">0</h3>
                                <p>Tổng sinh viên</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card">
                                <div class="stat-icon bg-success bg-opacity-10 text-success">
                                    <i class="bi bi-check-circle-fill"></i>
                                </div>
                                <h3 id="passedStudents">0</h3>
                                <p>Đã qua môn</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card">
                                <div class="stat-icon bg-danger bg-opacity-10 text-danger">
                                    <i class="bi bi-x-circle-fill"></i>
                                </div>
                                <h3 id="failedStudents">0</h3>
                                <p>Chưa qua môn</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card">
                                <div class="stat-icon bg-warning bg-opacity-10 text-warning">
                                    <i class="bi bi-graph-up"></i>
                                </div>
                                <h3 id="passRate">0%</h3>
                                <p>Tỷ lệ qua môn</p>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead class="table-primary">
                                        <tr>
                                            <th>STT</th>
                                            <th>MSSV</th>
                                            <th>Họ và tên</th>
                                            <th>Điểm tổng</th>
                                            <th>Trạng thái</th>
                                        </tr>
                                    </thead>
                                    <tbody id="resultsBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-success btn-lg mt-3" onclick="exportResults()">
                        <i class="bi bi-download"></i> Xuất kết quả Excel
                    </button>
                </div>
            </div>

            <!-- TAB 2: Quản lý Profile -->
            <div id="tab-profiles" class="tab-content">
                <h2 class="page-title mb-4">
                    <i class="bi bi-gear text-primary"></i> Quản lý Profile trọng số điểm
                </h2>

                <div class="mb-4">
                    <button class="btn btn-primary" onclick="createNewProfile()">
                        <i class="bi bi-plus-circle"></i> Tạo Profile mới
                    </button>
                    <button class="btn btn-outline-primary" onclick="exportAllProfiles()">
                        <i class="bi bi-download"></i> Xuất cấu hình
                    </button>
                    <label for="importProfilesFile" class="btn btn-outline-primary">
                        <i class="bi bi-upload"></i> Nhập cấu hình
                    </label>
                    <input type="file" id="importProfilesFile" accept=".json" style="display: none;"
                        onchange="importProfiles(event)">
                </div>

                <div id="profilesList" class="row g-3">
                    <div class="col-12 text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Đang tải...</span>
                        </div>
                        <p class="mt-3 text-muted">Đang tải danh sách profiles...</p>
                    </div>
                </div>
            </div>

            <!-- TAB 3: Quản lý Lớp học -->
            <div id="tab-classes" class="tab-content">
                <!-- Classes List View -->
                <div id="classes-list-view">
                    <h2 class="page-title mb-4">
                        <i class="bi bi-people text-primary"></i> Quản lý Lớp học
                    </h2>

                    <div class="mb-4">
                        <button class="btn btn-primary" onclick="createNewClass()">
                            <i class="bi bi-plus-circle"></i> Tạo lớp mới
                        </button>
                    </div>

                    <div id="classesList" class="row g-3">
                        <div class="col-12 text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Đang tải...</span>
                            </div>
                            <p class="mt-3 text-muted">Đang tải danh sách lớp học...</p>
                        </div>
                    </div>
                </div>

                <!-- Class Detail View -->
                <div id="class-detail-view" style="display: none;">
                    <div class="d-flex align-items-center mb-3 p-3 bg-white rounded-3 shadow-sm border">
                        <button class="btn btn-outline-primary btn-sm me-3" onclick="showClassesList()"
                            style="border-radius: 8px;">
                            <i class="bi bi-arrow-left me-1"></i> Quay lại
                        </button>
                        <div class="flex-grow-1">
                            <div class="d-flex align-items-center gap-2 mb-1">
                                <div class="d-flex align-items-center justify-content-center"
                                    style="width: 36px; height: 36px; background: linear-gradient(135deg, var(--fpt-orange) 0%, var(--fpt-orange-dark) 100%); border-radius: 8px;">
                                    <i class="bi bi-people text-white" style="font-size: 1rem;"></i>
                                </div>
                                <h2 class="page-title mb-0" id="classDetailName">Tên lớp</h2>
                            </div>
                            <p class="text-muted mb-0 ms-5 ps-1" style="font-size: 0.875rem;"
                                id="classDetailDescription">Mô tả lớp học</p>
                        </div>
                        <div>
                            <label class="form-label fw-semibold text-muted mb-1" style="font-size: 0.75rem;">
                                <i class="bi bi-sliders me-1"></i> Profile điểm
                            </label>
                            <select id="classProfileSelect" class="form-select" onchange="ClassesModule.changeProfile()"
                                style="min-width: 220px; border-radius: 8px;">
                                <option value="">-- Chọn profile điểm --</option>
                            </select>
                        </div>
                    </div>

                    <div class="row g-2 mb-3">
                        <div class="col-md-4">
                            <div class="stat-card">
                                <div class="stat-icon bg-primary bg-opacity-10 text-primary">
                                    <i class="bi bi-people-fill"></i>
                                </div>
                                <h3 id="classDetailStudentCount">0</h3>
                                <p>Tổng sinh viên</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-card">
                                <div class="stat-icon bg-success bg-opacity-10 text-success">
                                    <i class="bi bi-calendar-check"></i>
                                </div>
                                <h3 id="classDetailCreatedDate">-</h3>
                                <p>Ngày tạo</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-card">
                                <div class="stat-icon bg-info bg-opacity-10 text-info">
                                    <i class="bi bi-clock-history"></i>
                                </div>
                                <h3 id="classDetailUpdatedDate">-</h3>
                                <p>Cập nhật</p>
                            </div>
                        </div>
                    </div>

                    <!-- Grades Table -->
                    <div class="card shadow-sm border-0">
                        <div class="card-header bg-white d-flex justify-content-between align-items-center py-2 px-3">
                            <h6 class="mb-0 d-flex align-items-center gap-2">
                                <div class="d-flex align-items-center justify-content-center"
                                    style="width: 30px; height: 30px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 6px;">
                                    <i class="bi bi-table text-white" style="font-size: 0.875rem;"></i>
                                </div>
                                <span class="fw-semibold">Bảng điểm</span>
                            </h6>
                            <div class="d-flex gap-2">
                                <a href="student.html" class="btn btn-sm btn-outline-success">
                                    <i class="bi bi-share me-1"></i> share điểm
                                </a>
                                <input type="file" id="uploadGradesFile" accept=".xlsx, .xls" style="display: none;"
                                    onchange="ClassesModule.uploadGrades(event)">
                                <label for="uploadGradesFile" class="btn btn-sm btn-outline-success mb-0"
                                    style="border-radius: 6px;">
                                    <i class="bi bi-upload me-1"></i> Upload
                                </label>
                                <button class="btn btn-sm btn-outline-primary" onclick="ClassesModule.exportGrades()"
                                    style="border-radius: 6px;">
                                    <i class="bi bi-download me-1"></i> Xuất Excel
                                </button>
                                <button class="btn btn-sm btn-success" onclick="ClassesModule.saveGrades()"
                                    style="border-radius: 6px;">
                                    <i class="bi bi-save me-1"></i> Lưu
                                </button>
                                <button class="btn btn-sm btn-primary" onclick="editCurrentClass()"
                                    style="border-radius: 6px;">
                                    <i class="bi bi-pencil me-1"></i> Sửa
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive" style="max-height: 600px; overflow-y: auto;">
                                <table class="table table-hover mb-0" id="gradesTable">
                                    <thead class="sticky-top">
                                        <tr id="gradesTableHeader">
                                            <th style="width: 60px;" class="text-center">STT</th>
                                            <th style="width: 120px;">MSSV</th>
                                            <th style="min-width: 200px;">Họ và tên</th>
                                            <!-- Dynamic columns will be added here -->
                                            <th style="width: 100px;" class="text-center">Tổng</th>
                                            <th style="width: 120px;" class="text-center">Trạng thái</th>
                                        </tr>
                                    </thead>
                                    <tbody id="gradesTableBody">
                                        <tr>
                                            <td colspan="5" class="text-center py-5">
                                                <div class="text-muted">
                                                    <div class="d-flex align-items-center justify-content-center mb-3">
                                                        <div
                                                            style="width: 80px; height: 80px; background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                                            <i class="bi bi-info-circle"
                                                                style="font-size: 2.5rem; color: #9ca3af;"></i>
                                                        </div>
                                                    </div>
                                                    <p class="fw-semibold" style="color: #6b7280;">Vui lòng chọn profile
                                                        điểm để hiển thị bảng điểm</p>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        < </div>
                    </div>

                    <!-- TAB 4: Tạo Template -->
                    <div id="tab-template" class="tab-content">
                        <h2 class="page-title mb-4">
                            <i class="bi bi-file-earmark-text text-primary"></i> Tạo Template Excel
                        </h2>

                        <!-- Profile Selection -->
                        <div class="card mb-4">
                            <div class="card-header bg-warning bg-opacity-10">
                                <h5 class="mb-0 text-warning">
                                    <i class="bi bi-gear"></i> Chọn Profile điểm
                                </h5>
                            </div>
                            <div class="card-body">
                                <select id="templateProfileSelect" class="form-select"
                                    onchange="updateTemplateProfile()">
                                    <option value="">-- Chọn profile --</option>
                                </select>
                                <div id="templateProfileInfo" class="alert alert-warning mt-3 mb-0">
                                    Chưa chọn profile
                                </div>
                            </div>
                        </div>

                        <!-- Source Selection -->
                        <div class="card mb-4">
                            <div class="card-header bg-info bg-opacity-10">
                                <h5 class="mb-0 text-info">
                                    <i class="bi bi-list-ul"></i> Chọn nguồn danh sách sinh viên
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="templateSource" value="class"
                                            id="sourceClass" checked onchange="updateTemplateSource()">
                                        <label class="form-check-label fw-bold" for="sourceClass">
                                            Từ lớp đã lưu
                                        </label>
                                    </div>
                                    <div id="classSourceSection" class="ms-4 mt-2">
                                        <select id="templateClassSelect" class="form-select"
                                            onchange="updateTemplateClass()">
                                            <option value="">-- Chọn lớp --</option>
                                        </select>
                                        <div id="templateClassInfo" class="alert alert-info mt-2 mb-0">
                                            Chưa chọn lớp
                                        </div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="templateSource"
                                            value="upload" id="sourceUpload" onchange="updateTemplateSource()">
                                        <label class="form-check-label fw-bold" for="sourceUpload">
                                            Upload file danh sách mới
                                        </label>
                                    </div>
                                    <div id="uploadSourceSection" class="ms-4 mt-2" style="display: none;">
                                        <input type="file" id="classListInput" accept=".xlsx, .xls"
                                            style="display: none;" onchange="handleClassListUpload(event)">
                                        <label for="classListInput" class="btn btn-primary">
                                            <i class="bi bi-upload"></i> Chọn file danh sách
                                        </label>
                                        <span id="classListFileName" class="ms-2 text-primary"></span>
                                        <div class="alert alert-info mt-2 mb-0">
                                            <strong>Lưu ý:</strong> File cần có ít nhất 2 cột: MSSV và Họ và tên
                                        </div>
                                    </div>
                                </div>

                                <button class="btn btn-success btn-lg" onclick="generateTemplate()"
                                    id="generateTemplateBtn" disabled>
                                    <i class="bi bi-file-earmark-arrow-down"></i> Tạo Template Excel
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- TAB 5: Hẹn giờ -->
                    <div id="tab-timer" class="tab-content">
                        <h2 class="page-title mb-4">
                            <i class="bi bi-stopwatch text-primary"></i> Công cụ Hẹn giờ
                        </h2>

                        <!-- Create Timer Card -->
                        <div class="card mb-4 timer-create-card">
                            <div class="timer-create-header">
                                <i class="bi bi-plus-circle-fill"></i>
                                <h5>Tạo Timer mới</h5>
                            </div>

                            <div class="mb-3">
                                <input type="text" class="form-control" id="timerName"
                                    placeholder="Tên timer (VD: Ôn thi, Giải lao...)" maxlength="50">
                            </div>

                            <div class="timer-input-group">
                                <div class="timer-input-wrapper">
                                    <label>Giờ</label>
                                    <input type="number" id="timerHours" value="0" min="0" max="23">
                                </div>
                                <span class="timer-separator">:</span>
                                <div class="timer-input-wrapper">
                                    <label>Phút</label>
                                    <input type="number" id="timerMinutes" value="5" min="0" max="59">
                                </div>
                                <span class="timer-separator">:</span>
                                <div class="timer-input-wrapper">
                                    <label>Giây</label>
                                    <input type="number" id="timerSeconds" value="0" min="0" max="59">
                                </div>
                            </div>

                            <!-- Quick Timer Buttons -->
                            <div class="quick-timers">
                                <button class="quick-timer-btn"
                                    onclick="TimerModule.createQuickTimer(1, 'Timer 1 phút')">
                                    <i class="bi bi-lightning-fill"></i> 1 phút
                                </button>
                                <button class="quick-timer-btn"
                                    onclick="TimerModule.createQuickTimer(5, 'Timer 5 phút')">
                                    <i class="bi bi-lightning-fill"></i> 5 phút
                                </button>
                                <button class="quick-timer-btn"
                                    onclick="TimerModule.createQuickTimer(10, 'Giải lao 10 phút')">
                                    <i class="bi bi-cup-hot-fill"></i> 10 phút
                                </button>
                                <button class="quick-timer-btn" onclick="TimerModule.createQuickTimer(15, 'Nghỉ ngắn')">
                                    <i class="bi bi-emoji-smile-fill"></i> 15 phút
                                </button>
                                <button class="quick-timer-btn" onclick="TimerModule.createQuickTimer(25, 'Pomodoro')">
                                    <i class="bi bi-bullseye"></i> 25 phút
                                </button>
                                <button class="quick-timer-btn" onclick="TimerModule.createQuickTimer(45, 'Ôn bài')">
                                    <i class="bi bi-book-fill"></i> 45 phút
                                </button>
                                <button class="quick-timer-btn"
                                    onclick="TimerModule.createQuickTimer(60, 'Học tập 1 tiếng')">
                                    <i class="bi bi-mortarboard-fill"></i> 60 phút
                                </button>
                            </div>

                            <button class="btn btn-primary btn-lg w-100" onclick="TimerModule.handleCreateTimer()">
                                <i class="bi bi-plus-circle me-2"></i> Tạo Timer
                            </button>
                        </div>

                        <!-- Timers List -->
                        <div class="card">
                            <div class="card-header bg-light">
                                <h5 class="mb-0 d-flex align-items-center gap-2">
                                    <i class="bi bi-collection-fill text-primary"></i>
                                    Danh sách Timer
                                </h5>
                            </div>
                            <div class="card-body">
                                <div id="timersList" class="row g-3">
                                    <div class="text-center py-5">
                                        <div class="timer-empty-icon mb-3">
                                            <i class="bi bi-stopwatch"
                                                style="font-size: 4rem; color: var(--gray-300);"></i>
                                        </div>
                                        <p class="text-muted mb-0">Chưa có timer nào. Hãy tạo timer mới!</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Modal -->
            <div class="modal fade" id="profileModal" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header bg-light">
                            <h5 class="modal-title d-flex align-items-center gap-2">
                                <div class="d-flex align-items-center justify-content-center"
                                    style="width: 32px; height: 32px; background: linear-gradient(135deg, var(--fpt-orange) 0%, var(--fpt-orange-dark) 100%); border-radius: 8px;">
                                    <i class="bi bi-pencil-square text-white" style="font-size: 0.875rem;"></i>
                                </div>
                                <span>Chỉnh sửa Profile</span>
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label class="form-label fw-semibold text-dark" style="font-size: 0.875rem;">
                                    <i class="bi bi-tag-fill text-primary me-1"></i>
                                    Tên profile:
                                </label>
                                <input type="text" class="form-control" id="profileName"
                                    placeholder="VD: Kỳ học chính 2024">
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-semibold text-dark" style="font-size: 0.875rem;">
                                    <i class="bi bi-check-circle-fill text-success me-1"></i>
                                    Ngưỡng qua môn (điểm):
                                </label>
                                <input type="number" class="form-control" id="passThreshold" placeholder="3.0"
                                    step="0.1" min="0" max="10">
                            </div>

                            <div class="mb-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <label class="form-label fw-semibold text-dark mb-0" style="font-size: 0.875rem;">
                                        <i class="bi bi-list-check text-warning me-1"></i>
                                        Danh sách trọng số:
                                    </label>
                                    <button class="btn btn-sm btn-success" onclick="addWeightRow()">
                                        <i class="bi bi-plus-circle me-1"></i> Thêm
                                    </button>
                                </div>
                            </div>

                            <div id="weightEditor" class="weight-editor"></div>

                            <div class="mt-3 p-2 rounded"
                                style="background: linear-gradient(135deg, #fff5ed 0%, #ffe8d9 100%); border-left: 3px solid var(--fpt-orange);">
                                <div class="d-flex align-items-center gap-2">
                                    <div class="d-flex align-items-center justify-content-center"
                                        style="width: 40px; height: 40px; background: var(--fpt-orange); border-radius: 8px;">
                                        <i class="bi bi-calculator text-white" style="font-size: 1.125rem;"></i>
                                    </div>
                                    <div>
                                        <div class="text-muted small mb-0" style="font-size: 0.75rem;">Tổng trọng số
                                        </div>
                                        <div class="fs-4 fw-bold" style="color: var(--fpt-orange);">
                                            <span id="totalWeight">0</span>%
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer bg-light">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                <i class="bi bi-x-circle me-1"></i> Hủy
                            </button>
                            <button type="button" class="btn btn-danger" onclick="deleteCurrentProfile()"
                                id="deleteProfileBtn">
                                <i class="bi bi-trash me-1"></i> Xóa
                            </button>
                            <button type="button" class="btn btn-primary" onclick="saveProfile()">
                                <i class="bi bi-save me-1"></i> Lưu
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Class Modal -->
            <div class="modal fade" id="classModal" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header bg-light">
                            <h5 class="modal-title d-flex align-items-center gap-2">
                                <div class="d-flex align-items-center justify-content-center"
                                    style="width: 32px; height: 32px; background: linear-gradient(135deg, var(--fpt-blue) 0%, #0a2780 100%); border-radius: 8px;">
                                    <i class="bi bi-people text-white" style="font-size: 0.875rem;"></i>
                                </div>
                                <span>Chỉnh sửa lớp học</span>
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label class="form-label fw-semibold text-dark" style="font-size: 0.875rem;">
                                    <i class="bi bi-building text-primary me-1"></i>
                                    Tên lớp:
                                </label>
                                <input type="text" class="form-control" id="className" placeholder="VD: SE1801">
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-semibold text-dark" style="font-size: 0.875rem;">
                                    <i class="bi bi-file-text text-info me-1"></i>
                                    Mô tả:
                                </label>
                                <input type="text" class="form-control" id="classDescription"
                                    placeholder="VD: Lập trình Java - Khóa 18">
                            </div>

                            <div class="mb-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <label class="form-label fw-semibold text-dark mb-0" style="font-size: 0.875rem;">
                                        <i class="bi bi-person-lines-fill text-success me-1"></i>
                                        Danh sách sinh viên:
                                    </label>
                                    <div class="d-flex gap-2">
                                        <input type="file" id="classStudentListInput" accept=".xlsx, .xls"
                                            style="display: none;" onchange="handleClassStudentUpload(event)">
                                        <label for="classStudentListInput" class="btn btn-sm btn-primary mb-0">
                                            <i class="bi bi-upload me-1"></i> Upload
                                        </label>
                                        <button class="btn btn-sm btn-success" onclick="addStudentRow()">
                                            <i class="bi bi-plus-circle me-1"></i> Thêm
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div id="studentEditor" class="weight-editor"></div>

                            <div class="mt-3 p-2 rounded"
                                style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-left: 3px solid var(--fpt-blue);">
                                <div class="d-flex align-items-center gap-2">
                                    <div class="d-flex align-items-center justify-content-center"
                                        style="width: 40px; height: 40px; background: var(--fpt-blue); border-radius: 8px;">
                                        <i class="bi bi-people-fill text-white" style="font-size: 1.125rem;"></i>
                                    </div>
                                    <div>
                                        <div class="text-muted small mb-0" style="font-size: 0.75rem;">Tổng số sinh viên
                                        </div>
                                        <div class="fs-4 fw-bold" style="color: var(--fpt-blue);">
                                            <span id="classStudentCount">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer bg-light">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                <i class="bi bi-x-circle me-1"></i> Hủy
                            </button>
                            <button type="button" class="btn btn-primary" onclick="saveClass()">
                                <i class="bi bi-save me-1"></i> Lưu
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bootstrap 5 JS Bundle -->
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

            <!-- Router -->
            <script src="/js/router.js"></script>

            <!-- Modules -->
            <script src="/js/modules/auth.js"></script>
            <script src="/js/modules/gradeCheck.js"></script>
            <script src="/js/modules/profilesView.js"></script>
            <script src="/js/modules/classes.js"></script>
            <script src="/js/modules/template.js"></script>
            <script src="/js/modules/timer.js"></script>

            <!-- Routes Configuration -->
            <script src="/js/routes.js"></script>

            <!-- Main App (Core functions and API) -->
            <script src="/js/app.js"></script>

            <!-- ES6 Module Initialization -->
            <script type="module" src="/js/init.js"></script>

            <script>
                const APP_BRANDING_DEFAULTS = {
                    logoDataUrl: 'https://caodang.fpt.edu.vn/wp-content/uploads/logo-3.png',
                    subtext: 'FPT Polytechnic'
                };

                function normalizeBranding(payload) {
                    const source = payload || {};
                    return {
                        logoDataUrl: String(source.logoDataUrl || APP_BRANDING_DEFAULTS.logoDataUrl).trim() || APP_BRANDING_DEFAULTS.logoDataUrl,
                        subtext: String(source.subtext || APP_BRANDING_DEFAULTS.subtext).trim() || APP_BRANDING_DEFAULTS.subtext
                    };
                }

                function applyAppBranding(brandingPayload) {
                    const branding = normalizeBranding(brandingPayload);
                    window.__APP_BRANDING__ = branding;

                    const sidebarLogo = document.getElementById('appSidebarLogo');
                    if (sidebarLogo) {
                        sidebarLogo.src = branding.logoDataUrl;
                        sidebarLogo.alt = branding.subtext;
                    }

                    const headerLogo = document.getElementById('appHeaderLogo');
                    if (headerLogo) {
                        headerLogo.src = branding.logoDataUrl;
                        headerLogo.alt = branding.subtext;
                    }

                    const subtextEl = document.getElementById('appHeaderSubtext');
                    if (subtextEl) {
                        subtextEl.textContent = branding.subtext;
                    }
                }

                async function loadAppBranding() {
                    applyAppBranding(APP_BRANDING_DEFAULTS);
                    try {
                        const response = await fetch('/api/public/branding');
                        const result = await response.json().catch(() => ({}));
                        if (!response.ok || !result.success || !result.data) {
                            return;
                        }
                        applyAppBranding(result.data);
                    } catch (error) {
                        console.warn('Cannot load app branding:', error.message);
                    }
                }

                // Wait for DOM to be ready before attaching event listeners
                document.addEventListener('DOMContentLoaded', function () {
                    loadAppBranding();

                    // Toggle sidebar
                    const toggleBtn = document.getElementById('toggleSidebar');
                    if (toggleBtn) {
                        toggleBtn.addEventListener('click', function () {
                            const sidebar = document.getElementById('sidebar');
                            const mainContent = document.querySelector('.main-content');
                            const isMobile = window.innerWidth < 768;

                            if (isMobile) {
                                sidebar.classList.toggle('show');
                            } else {
                                sidebar.classList.toggle('collapsed');
                                // Also toggle body class for reliable CSS
                                document.body.classList.toggle('sidebar-collapsed');
                                // Update main content margin
                                if (sidebar.classList.contains('collapsed')) {
                                    mainContent.style.marginLeft = 'var(--sidebar-collapsed-width)';
                                } else {
                                    mainContent.style.marginLeft = 'var(--sidebar-width)';
                                }
                            }
                        });
                    }

                    // Close sidebar when clicking outside on mobile
                    document.addEventListener('click', function (event) {
                        const sidebar = document.getElementById('sidebar');
                        const toggleBtn = document.getElementById('toggleSidebar');
                        const isMobile = window.innerWidth < 768;

                        if (isMobile && sidebar.classList.contains('show')) {
                            if (!sidebar.contains(event.target) && !toggleBtn.contains(event.target)) {
                                sidebar.classList.remove('show');
                            }
                        }
                    });
                });

                // Update mobile nav active state
                function updateMobileNav(tabName) {
                    const mobileNavItems = document.querySelectorAll('.mobile-nav-item');
                    mobileNavItems.forEach(item => {
                        item.classList.remove('active');
                        const onclick = item.getAttribute('onclick');
                        if (onclick && onclick.includes(tabName)) {
                            item.classList.add('active');
                        }
                    });
                }

                // Initialize modules and routes when DOM is ready
                document.addEventListener('DOMContentLoaded', async function () {
                    try {
                        // Initialize authentication first
                        await AuthModule.init();

                        // Only initialize other modules if authenticated
                        if (AuthModule.isAuthenticated) {
                            // Initialize modules
                            GradeCheckModule.init();
                            ClassesModule.init();
                            TemplateModule.init();
                            TimerModule.init();

                            // Load initial data
                            await initDefaultProfiles();
                            await initClasses();

                            // Initialize routes after data is loaded
                            initializeRoutes();
                        }
                    } catch (error) {
                        console.error('Initialization error:', error);
                    }
                });

                // Update modal references for Bootstrap 5
                function closeProfileModal() {
                    const modal = bootstrap.Modal.getInstance(document.getElementById('profileModal'));
                    if (modal) modal.hide();
                }

                function closeClassModal() {
                    const modal = bootstrap.Modal.getInstance(document.getElementById('classModal'));
                    if (modal) modal.hide();
                }

                // Show modals with Bootstrap 5
                window.showProfileModal = function () {
                    const modal = new bootstrap.Modal(document.getElementById('profileModal'));
                    modal.show();
                };

                window.showClassModal = function () {
                    const modal = new bootstrap.Modal(document.getElementById('classModal'));
                    modal.show();
                };
            </script>
</body>

</html>
